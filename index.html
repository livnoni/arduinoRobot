<!DOCTYPE html>
<html lang="en">
<style>
    .button {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
    }
</style>

<head>
    <meta charset="UTF-8">
    <title>Yehuda Robot</title>
</head>
<body>
<center>
    <H1>Robo-Yuda</H1>
    <div>
        Robot ip:<br>
        <input id="ip-input" type="text" name="ip" value="YOUR_ROBOT_IP_HERE" size="40"
               onchange="onIpInputChange()"><br>
    </div>
    <br>
    <button onclick="setVideoSize('INCREASE')" style="font-size:20px; margin-right:50px">Increase Video +</button>
    <button onclick="setVideoSize('DECREASE')" style="font-size:20px; margin-left:50px">Decrease Video -</button>
    <br>
    <br>
    <div>
        <img id="live-camera" width="640" height="480">
    </div>

    <br>
    <div>
        Type text that the robot will say:
        <textarea rows="2" cols="50" id="say-input"></textarea>
        <button id='say_button' onclick="onSayInputChange()">Robot Say!</button>
        <select id="say_select">
            <option id="say_1">multi by 1</option>
            <option id="say_2">multi by 2</option>
            <option id="say_3">multi by 3</option>
            <option id="say_4">multi by 4</option>
            <option id="say_5">multi by 5</option>
            <option id="say_6">multi by 6</option>
            <option id="say_7">multi by 7</option>
            <option id="say_8">multi by 8</option>
            <option id="say_9">multi by 9</option>
            <option id="say_10">multi by 10</option>
        </select>
    </div>
    <br>
    <div>
        Playing youtube songs:
        <input id="youtube-input" type="text" name="yutube" value="https://www.youtube.com/watch?v=SESSION_ID" size="40"
               onchange="onIpInputChange()">
        <button id="button-youtube-play" onclick="onYoutube()">Play</button>
        <button id="button-youtube-stop" onclick="onYoutube('STOP')">Stop</button>
    </div>

    <br>
    <button onclick="setButtonSize('INCREASE')" style="font-size:20px; margin-right:50px">Increase Buttons +</button>
    <button onclick="setButtonSize('DECREASE')" style="font-size:20px; margin-left:50px">Decrease Buttons -</button>
    <br>
    <br>

    <div style="text-align:center;width:800px;">
        <div style="float: right; margin-right: 10px">
            <button class="button" id="button-FORWARD" onmousedown="buttonPressed('FORWARD')"
                    onmouseup="buttonReleased('FORWARD')"
            >FORWARD [&#8593]
            </button>
            <br><br>
            <button class="button" id="button-LEFT" onmousedown="buttonPressed('LEFT')"
                    onmouseup="buttonReleased('LEFT')">LEFT [&#8592]
            </button>
            <button class="button" id="button-RIGHT" onmousedown="buttonPressed('RIGHT')"
                    onmouseup="buttonReleased('RIGHT')"
            >RIGHT [&#8594]
            </button>
            <br><br>
            <button class="button" id="button-BACKWARD" onmousedown="buttonPressed('BACKWARD')"
                    onmouseup="buttonReleased('BACKWARD')"
            >BACKWARD [&#8595]
            </button>
        </div>
        <div style="float: left">
            <button class="button" id="button-CAMERA_UP" onmousedown="buttonPressed('CAMERA_UP')"
                    onmouseup="buttonReleased('CAMERA_UP')"
            >Camera Up [w]
            </button>
            <br><br>
            <button class="button" id="button-CAMERA_DOWN" onmousedown="buttonPressed('CAMERA_DOWN')"
                    onmouseup="buttonReleased('CAMERA_DOWN')"
            >Camera Down [s]
            </button>
        </div>


        <br>

    </div>
</center>

<script src="/socket.io/socket.io.js"></script>
<script>
    var sayInput = document.getElementById("say-input");
    var sayInputActive = false;

    sayInput.addEventListener("focus", () => {
        sayInputActive = true;
    }, true);
    sayInput.addEventListener("blur", () => {
        sayInputActive = false;
    }, true);

    window.addEventListener("keydown", function (e) {
        // space and arrow keys
        if (!sayInputActive && [32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
            e.preventDefault();
        }
    }, false);

    function setVideoSize(param) {
        let currentWidth = document.getElementById("live-camera").width;
        let currentHeight = document.getElementById("live-camera").height;
        document.getElementById("live-camera").width = param == "INCREASE" ? currentWidth + 100 : currentWidth - 100;
        document.getElementById("live-camera").height = param == "INCREASE" ? currentHeight + 100 : currentHeight - 100;
    }

    function setButtonSize(param) {
        console.log("param=", param)
        var el = document.getElementsByClassName("button")[0];
        var style = window.getComputedStyle(el, null).getPropertyValue('font-size');
        var currentSize = parseFloat(style);

        for (let i = 0; i < document.getElementsByClassName("button").length; i++) {
            document.getElementsByClassName("button")[i].style.fontSize = param == "INCREASE" ? (currentSize + 10) + 'px' : (currentSize - 10) + 'px';
        }
    }


    function buttonPressed(direction) {
        console.log('buttonPressed=', direction);
        emit(direction);
    }

    function buttonReleased(direction) {
        console.log('buttonReleased=', direction);
        emit("STOP");
    }


    var socket = io();

    document.onkeydown = function (evt) {
        evt = evt || window.event;
        if (!sayInputActive) {
            switch (evt.key) {
                case 'ArrowUp':
                    emit("FORWARD");
                    break;
                case 'ArrowDown':
                    emit("BACKWARD");
                    break;
                case 'ArrowLeft':
                    emit("LEFT");
                    break;
                case 'ArrowRight':
                    emit("RIGHT");
                    break;
                case 'w' || "'":
                    emit("CAMERA_UP");
                    break;
                case 's' || "ד":
                    emit("CAMERA_DOWN");
                    break;
                case  "'":
                    emit("CAMERA_UP");
                    break;
                case  "ד":
                    emit("CAMERA_DOWN");
                    break;
            }
        }

    };

    document.onkeyup = function (evt) {
        evt = evt || window.event;
        if (!sayInputActive) {
            switch (evt.key) {
                case 'ArrowUp':
                    emit("STOP");
                    break;
                case 'ArrowDown':
                    emit("STOP");
                    break;
                case 'ArrowLeft':
                    emit("STOP");
                    break;
                case 'ArrowRight':
                    emit("STOP");
                    break;
                case 'w':
                    emit("CAMERA_STOP");
                    break;
                case 's':
                    emit("CAMERA_STOP");
                    break;
                case  "'":
                    emit("CAMERA_STOP");
                    break;
                case  "ד":
                    emit("CAMERA_STOP");
                    break;
            }
        }
    };

    function emit(data) {
        console.log(data);
        let buttons = document.getElementsByClassName("button");
        for (let i = 0; i < buttons.length; i++) {
            if (data != "STOP" && buttons[i].id.includes(data)) buttons[i].style.background = 'blue';
            else buttons[i].style.background = '#4CAF50';
        }
        if (data.includes("CAMERA")) {
            socket.emit('camera', data);
        } else {
            socket.emit('robot', data);
        }

    }

    function setVideoStreaming() {
        let currentUrl = window.location.href;
        let videoSrc = currentUrl.split(":3000")[0] + ":8000/stream.mjpg";
        document.getElementById("live-camera").src = videoSrc;
        document.getElementById("ip-input").value = videoSrc;
    }

    setVideoStreaming();


    function onIpInputChange() {
        let ip = document.getElementById("ip-input").value;
        document.getElementById("live-camera").src = ip;
    }

    function onSayInputChange() {
        let sayButton = document.getElementById("say_button");
        sayButton.disabled = true;
        setTimeout(()=>{sayButton.disabled = false},2000)
        let sayData = document.getElementById("say-input").value+"\n";
        let multiplyBy = document.getElementById("say_select").options[document.getElementById("say_select").selectedIndex].value.split("multi by ")[1];
        console.log("sayData=", sayData);
        console.log("multiplyBy=", multiplyBy);
        socket.emit('say', sayData.repeat(multiplyBy));
    }

    function onYoutube(data) {
        let buttonPlay = document.getElementById("button-youtube-play");
        if (data == "STOP") {
            console.log("youtube->STOP");
            socket.emit('youtube', data);
            buttonPlay.style.background = "";
        } else {
            let youtubeUrl = document.getElementById("youtube-input").value;
            console.log("youtube=", youtubeUrl);
            socket.emit('youtube', youtubeUrl);
            buttonPlay.style.background = "blue";
        }

    }

</script>
</body>
</html>